Return-Path: <linux-nvdimm-bounces@lists.01.org>
X-Original-To: lists+linux-nvdimm@lfdr.de
Delivered-To: lists+linux-nvdimm@lfdr.de
Received: from ml01.01.org (ml01.01.org [198.145.21.10])
	by mail.lfdr.de (Postfix) with ESMTPS id 45FC726B9C5
	for <lists+linux-nvdimm@lfdr.de>; Wed, 16 Sep 2020 04:17:09 +0200 (CEST)
Received: from ml01.vlan13.01.org (localhost [IPv6:::1])
	by ml01.01.org (Postfix) with ESMTP id EA0F213DB53EC;
	Tue, 15 Sep 2020 19:17:07 -0700 (PDT)
Received-SPF: None (mailfrom) identity=mailfrom; client-ip=183.91.158.132; helo=heian.cn.fujitsu.com; envelope-from=ruansy.fnst@cn.fujitsu.com; receiver=<UNKNOWN> 
Received: from heian.cn.fujitsu.com (mail.cn.fujitsu.com [183.91.158.132])
	by ml01.01.org (Postfix) with ESMTP id 548F313DB53EB
	for <linux-nvdimm@lists.01.org>; Tue, 15 Sep 2020 19:17:05 -0700 (PDT)
X-IronPort-AV: E=Sophos;i="5.76,430,1592841600";
   d="scan'208";a="99286199"
Received: from unknown (HELO cn.fujitsu.com) ([10.167.33.5])
  by heian.cn.fujitsu.com with ESMTP; 16 Sep 2020 10:17:04 +0800
Received: from G08CNEXMBPEKD05.g08.fujitsu.local (unknown [10.167.33.204])
	by cn.fujitsu.com (Postfix) with ESMTP id 2B9A24CE34D2;
	Wed, 16 Sep 2020 10:17:04 +0800 (CST)
Received: from irides.mr (10.167.225.141) by G08CNEXMBPEKD05.g08.fujitsu.local
 (10.167.33.204) with Microsoft SMTP Server (TLS) id 15.0.1497.2; Wed, 16 Sep
 2020 10:17:02 +0800
Subject: Re: [RFC PATCH 2/4] pagemap: introduce ->memory_failure()
To: "Darrick J. Wong" <darrick.wong@oracle.com>
References: <20200915101311.144269-1-ruansy.fnst@cn.fujitsu.com>
 <20200915101311.144269-3-ruansy.fnst@cn.fujitsu.com>
 <20200915163104.GG7964@magnolia>
From: Ruan Shiyang <ruansy.fnst@cn.fujitsu.com>
Message-ID: <7afb6987-17f7-feb7-1ca9-05ff84185086@cn.fujitsu.com>
Date: Wed, 16 Sep 2020 10:15:52 +0800
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101
 Thunderbird/68.11.0
MIME-Version: 1.0
In-Reply-To: <20200915163104.GG7964@magnolia>
Content-Language: en-US
X-Originating-IP: [10.167.225.141]
X-ClientProxiedBy: G08CNEXCHPEKD06.g08.fujitsu.local (10.167.33.205) To
 G08CNEXMBPEKD05.g08.fujitsu.local (10.167.33.204)
X-yoursite-MailScanner-ID: 2B9A24CE34D2.AAD81
X-yoursite-MailScanner: Found to be clean
X-yoursite-MailScanner-From: ruansy.fnst@cn.fujitsu.com
X-Spam-Status: No
Message-ID-Hash: PTSWJAODVBRBKYOONGYGNM2KQD6TAKTE
X-Message-ID-Hash: PTSWJAODVBRBKYOONGYGNM2KQD6TAKTE
X-MailFrom: ruansy.fnst@cn.fujitsu.com
X-Mailman-Rule-Misses: dmarc-mitigation; no-senders; approved; emergency; loop; banned-address; member-moderation; nonmember-moderation; administrivia; implicit-dest; max-recipients; max-size; news-moderation; no-subject; suspicious-header
CC: linux-kernel@vger.kernel.org, linux-xfs@vger.kernel.org, linux-nvdimm@lists.01.org, linux-mm@kvack.org, linux-fsdevel@vger.kernel.org, david@fromorbit.com, hch@lst.de, rgoldwyn@suse.de, qi.fuli@fujitsu.com, y-goto@fujitsu.com
X-Mailman-Version: 3.1.1
Precedence: list
List-Id: "Linux-nvdimm developer list." <linux-nvdimm.lists.01.org>
Archived-At: <https://lists.01.org/hyperkitty/list/linux-nvdimm@lists.01.org/message/PTSWJAODVBRBKYOONGYGNM2KQD6TAKTE/>
List-Archive: <https://lists.01.org/hyperkitty/list/linux-nvdimm@lists.01.org/>
List-Help: <mailto:linux-nvdimm-request@lists.01.org?subject=help>
List-Post: <mailto:linux-nvdimm@lists.01.org>
List-Subscribe: <mailto:linux-nvdimm-join@lists.01.org>
List-Unsubscribe: <mailto:linux-nvdimm-leave@lists.01.org>
Content-Type: text/plain; charset="utf-8"; format="flowed"
Content-Transfer-Encoding: base64

DQoNCk9uIDIwMjAvOS8xNiDkuIrljYgxMjozMSwgRGFycmljayBKLiBXb25nIHdyb3RlOg0KPiBP
biBUdWUsIFNlcCAxNSwgMjAyMCBhdCAwNjoxMzowOVBNICswODAwLCBTaGl5YW5nIFJ1YW4gd3Jv
dGU6DQo+PiBXaGVuIG1lbW9yeS1mYWlsdXJlIG9jY3Vycywgd2UgY2FsbCB0aGlzIGZ1bmN0aW9u
IHdoaWNoIGlzIGltcGxlbWVudGVkDQo+PiBieSBlYWNoIGRldmljZXMuICBGb3IgZnNkYXgsIHBt
ZW0gZGV2aWNlIGltcGxlbWVudHMgaXQuICBQbWVtIGRldmljZQ0KPj4gd2lsbCBmaW5kIG91dCB0
aGUgYmxvY2sgZGV2aWNlIHdoZXJlIHRoZSBlcnJvciBwYWdlIGxvY2F0ZWQgaW4sIGdldHMgdGhl
DQo+PiBmaWxlc3lzdGVtIG9uIHRoaXMgYmxvY2sgZGV2aWNlLCBhbmQgZmluYWxseSBjYWxsIC0+
c3RvcmFnZV9sb3N0KCkgdG8NCj4+IGhhbmRsZSB0aGUgZXJyb3IgaW4gZmlsZXN5c3RlbSBsYXll
ci4NCj4+DQo+PiBOb3JtYWxseSwgYSBwbWVtIGRldmljZSBtYXkgY29udGFpbiBvbmUgb3IgbW9y
ZSBwYXJ0aXRpb25zLCBlYWNoDQo+PiBwYXJ0aXRpb24gY29udGFpbnMgYSBibG9jayBkZXZpY2Us
IGVhY2ggYmxvY2sgZGV2aWNlIGNvbnRhaW5zIGENCj4+IGZpbGVzeXN0ZW0uICBTbyB3ZSBhcmUg
YWJsZSB0byBmaW5kIG91dCB0aGUgZmlsZXN5c3RlbSBieSBvbmUgb2Zmc2V0IG9uDQo+PiB0aGlz
IHBtZW0gZGV2aWNlLiAgSG93ZXZlciwgaW4gb3RoZXIgY2FzZXMsIHN1Y2ggYXMgbWFwcGVkIGRl
dmljZSwgSQ0KPj4gZGlkbid0IGZpbmQgYSB3YXkgdG8gb2J0YWluIHRoZSBmaWxlc3lzdGVtIGxh
eWluZyBvbiBpdC4gIEl0IGlzIGENCj4+IHByb2JsZW0gbmVlZCB0byBiZSBmaXhlZC4NCj4+DQo+
PiBTaWduZWQtb2ZmLWJ5OiBTaGl5YW5nIFJ1YW4gPHJ1YW5zeS5mbnN0QGNuLmZ1aml0c3UuY29t
Pg0KPj4gLS0tDQo+PiAgIGJsb2NrL2dlbmhkLmMgICAgICAgICAgICB8IDEyICsrKysrKysrKysr
Kw0KPj4gICBkcml2ZXJzL252ZGltbS9wbWVtLmMgICAgfCAzMSArKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrDQo+PiAgIGluY2x1ZGUvbGludXgvZ2VuaGQuaCAgICB8ICAyICsrDQo+PiAg
IGluY2x1ZGUvbGludXgvbWVtcmVtYXAuaCB8ICAzICsrKw0KPj4gICA0IGZpbGVzIGNoYW5nZWQs
IDQ4IGluc2VydGlvbnMoKykNCj4+DQo+PiBkaWZmIC0tZ2l0IGEvYmxvY2svZ2VuaGQuYyBiL2Js
b2NrL2dlbmhkLmMNCj4+IGluZGV4IDk5YzY0NjQxYzMxNC4uZTc0NDJiNjA2ODNlIDEwMDY0NA0K
Pj4gLS0tIGEvYmxvY2svZ2VuaGQuYw0KPj4gKysrIGIvYmxvY2svZ2VuaGQuYw0KPj4gQEAgLTEw
NjMsNiArMTA2MywxOCBAQCBzdHJ1Y3QgYmxvY2tfZGV2aWNlICpiZGdldF9kaXNrKHN0cnVjdCBn
ZW5kaXNrICpkaXNrLCBpbnQgcGFydG5vKQ0KPj4gICB9DQo+PiAgIEVYUE9SVF9TWU1CT0woYmRn
ZXRfZGlzayk7DQo+PiAgIA0KPj4gK3N0cnVjdCBibG9ja19kZXZpY2UgKmJkZ2V0X2Rpc2tfc2Vj
dG9yKHN0cnVjdCBnZW5kaXNrICpkaXNrLCBzZWN0b3JfdCBzZWN0b3IpDQo+PiArew0KPj4gKwlz
dHJ1Y3QgYmxvY2tfZGV2aWNlICpiZGV2ID0gTlVMTDsNCj4+ICsJc3RydWN0IGhkX3N0cnVjdCAq
cGFydCA9IGRpc2tfbWFwX3NlY3Rvcl9yY3UoZGlzaywgc2VjdG9yKTsNCj4+ICsNCj4+ICsJaWYg
KHBhcnQpDQo+PiArCQliZGV2ID0gYmRnZXQocGFydF9kZXZ0KHBhcnQpKTsNCj4+ICsNCj4+ICsJ
cmV0dXJuIGJkZXY7DQo+PiArfQ0KPj4gK0VYUE9SVF9TWU1CT0woYmRnZXRfZGlza19zZWN0b3Ip
Ow0KPj4gKw0KPj4gICAvKg0KPj4gICAgKiBwcmludCBhIGZ1bGwgbGlzdCBvZiBhbGwgcGFydGl0
aW9ucyAtIGludGVuZGVkIGZvciBwbGFjZXMgd2hlcmUgdGhlIHJvb3QNCj4+ICAgICogZmlsZXN5
c3RlbSBjYW4ndCBiZSBtb3VudGVkIGFuZCB0aHVzIHRvIGdpdmUgdGhlIHZpY3RpbSBzb21lIGlk
ZWEgb2Ygd2hhdA0KPj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvbnZkaW1tL3BtZW0uYyBiL2RyaXZl
cnMvbnZkaW1tL3BtZW0uYw0KPj4gaW5kZXggZmFiMjliNTE0MzcyLi4zZWQ5NjQ4NmM4ODMgMTAw
NjQ0DQo+PiAtLS0gYS9kcml2ZXJzL252ZGltbS9wbWVtLmMNCj4+ICsrKyBiL2RyaXZlcnMvbnZk
aW1tL3BtZW0uYw0KPj4gQEAgLTM2NCw5ICszNjQsNDAgQEAgc3RhdGljIHZvaWQgcG1lbV9yZWxl
YXNlX2Rpc2sodm9pZCAqX19wbWVtKQ0KPj4gICAJcHV0X2Rpc2socG1lbS0+ZGlzayk7DQo+PiAg
IH0NCj4+ICAgDQo+PiArc3RhdGljIGludCBwbWVtX3BhZ2VtYXBfbWVtb3J5X2ZhaWx1cmUoc3Ry
dWN0IGRldl9wYWdlbWFwICpwZ21hcCwNCj4+ICsJCXN0cnVjdCBtZl9yZWNvdmVyX2NvbnRyb2xs
ZXIgKm1mcmMpDQo+PiArew0KPj4gKwlzdHJ1Y3QgcG1lbV9kZXZpY2UgKnBkZXY7DQo+PiArCXN0
cnVjdCBibG9ja19kZXZpY2UgKmJkZXY7DQo+PiArCXNlY3Rvcl90IGRpc2tfc2VjdG9yOw0KPj4g
Kwlsb2ZmX3QgYmRldl9vZmZzZXQ7DQo+PiArDQo+PiArCXBkZXYgPSBjb250YWluZXJfb2YocGdt
YXAsIHN0cnVjdCBwbWVtX2RldmljZSwgcGdtYXApOw0KPj4gKwlpZiAoIXBkZXYtPmRpc2spDQo+
PiArCQlyZXR1cm4gLUVOWElPOw0KPj4gKw0KPj4gKwlkaXNrX3NlY3RvciA9IChQRk5fUEhZUyht
ZnJjLT5wZm4pIC0gcGRldi0+cGh5c19hZGRyKSA+PiBTRUNUT1JfU0hJRlQ7DQo+IA0KPiBBaCwg
SSBzZWUsIGxvb2tpbmcgYXQgdGhlIGN1cnJlbnQgeDg2IE1DRSBjb2RlLCB0aGUgTUNFIGhhbmRs
ZXIgZ2V0cyBhDQo+IHBoeXNpY2FsIGFkZHJlc3MsIHdoaWNoIGlzIHRoZW4gcm91bmRlZCBkb3du
IHRvIGEgUEZOLCB3aGljaCBpcyB0aGVuDQo+IGJsb3duIGJhY2sgdXAgaW50byBhIGJ5dGUgYWRk
cmVzcyg/KSBhbmQgdGhlbiByb3VuZGVkIGRvd24gdG8gc2VjdG9ycy4NCj4gVGhhdCBpcyB0aGVu
IGJsb3duIGJhY2sgdXAgaW50byBhIGJ5dGUgYWRkcmVzcyBhbmQgcGFzc2VkIG9uIHRvIFhGUywN
Cj4gd2hpY2ggcm91bmRzIGl0IGRvd24gdG8gZnMgYmxvY2tzaXplLg0KPiANCj4gL21lIHdpc2hl
cyB0aGF0IHdhc24ndCBzbyBjb252b2x1dGVkLCBidXQgcmVmb3JtaW5nIHRoZSB3aG9sZSBtbSBw
b2lzb24NCj4gc3lzdGVtIHRvIGhhdmUgc21hbGxlciBibGFzdCByYWRpaSBpc24ndCB0aGUgcHVy
cG9zZSBvZiB0aGlzIHBhdGNoLiA6KQ0KPiANCj4+ICsJYmRldiA9IGJkZ2V0X2Rpc2tfc2VjdG9y
KHBkZXYtPmRpc2ssIGRpc2tfc2VjdG9yKTsNCj4+ICsJaWYgKCFiZGV2KQ0KPj4gKwkJcmV0dXJu
IC1FTlhJTzsNCj4+ICsNCj4+ICsJLy8gVE9ETyB3aGF0IGlmIGJsb2NrIGRldmljZSBjb250YWlu
cyBhIG1hcHBlZCBkZXZpY2UNCj4gDQo+IEZpbmQgaXRzIGRldl9wYWdlbWFwX29wcyBhbmQgaW52
b2tlIGl0cyBtZW1vcnlfZmFpbHVyZSBmdW5jdGlvbj8gOykNCg0KVGhhbmtzIGZvciBwb2ludGlu
ZyBvdXQuICBJJ2xsIHRoaW5rIGFib3V0IGl0IGluIHRoaXMgd2F5Lg0KPiANCj4+ICsJaWYgKCFi
ZGV2LT5iZF9zdXBlcikNCj4+ICsJCWdvdG8gb3V0Ow0KPj4gKw0KPj4gKwliZGV2X29mZnNldCA9
ICgoZGlza19zZWN0b3IgLSBnZXRfc3RhcnRfc2VjdChiZGV2KSkgPDwgU0VDVE9SX1NISUZUKSAt
DQo+PiArCQkJcGRldi0+ZGF0YV9vZmZzZXQ7DQo+PiArCWJkZXYtPmJkX3N1cGVyLT5zX29wLT5z
dG9yYWdlX2xvc3QoYmRldi0+YmRfc3VwZXIsIGJkZXZfb2Zmc2V0LCBtZnJjKTsNCj4gDQo+IC0+
c3RvcmFnZV9sb3N0IGlzIHJlcXVpcmVkIGZvciBhbGwgZmlsZXN5c3RlbXM/DQoNCkkgdGhpbmsg
aXQgaXMgcmVxdWlyZWQgZm9yIGZpbGVzeXN0ZW1zIHRoYXQgc3VwcG9ydCBmc2RheCwgc2luY2Ug
dGhlIA0Kb3duZXIgdHJhY2tpbmcgaXMgbW92ZWQgaGVyZS4gIEJ1dCBhbnl3YXksIHRoZXJlIHNo
b3VsZCBoYXZlIGEgbm9uLU5VTEwgDQpqdWRnbWVudC4NCg0KDQotLQ0KVGhhbmtzLA0KUnVhbiBT
aGl5YW5nLg0KPiANCj4gLS1EDQo+IA0KPj4gKw0KPj4gK291dDoNCj4+ICsJYmRwdXQoYmRldik7
DQo+PiArCXJldHVybiAwOw0KPj4gK30NCj4+ICsNCj4+ICAgc3RhdGljIGNvbnN0IHN0cnVjdCBk
ZXZfcGFnZW1hcF9vcHMgZnNkYXhfcGFnZW1hcF9vcHMgPSB7DQo+PiAgIAkua2lsbAkJCT0gcG1l
bV9wYWdlbWFwX2tpbGwsDQo+PiAgIAkuY2xlYW51cAkJPSBwbWVtX3BhZ2VtYXBfY2xlYW51cCwN
Cj4+ICsJLm1lbW9yeV9mYWlsdXJlCQk9IHBtZW1fcGFnZW1hcF9tZW1vcnlfZmFpbHVyZSwNCj4+
ICAgfTsNCj4+ICAgDQo+PiAgIHN0YXRpYyBpbnQgcG1lbV9hdHRhY2hfZGlzayhzdHJ1Y3QgZGV2
aWNlICpkZXYsDQo+PiBkaWZmIC0tZ2l0IGEvaW5jbHVkZS9saW51eC9nZW5oZC5oIGIvaW5jbHVk
ZS9saW51eC9nZW5oZC5oDQo+PiBpbmRleCA0YWI4NTM0NjFkZmYuLjE2ZTllMTNlMDg0MSAxMDA2
NDQNCj4+IC0tLSBhL2luY2x1ZGUvbGludXgvZ2VuaGQuaA0KPj4gKysrIGIvaW5jbHVkZS9saW51
eC9nZW5oZC5oDQo+PiBAQCAtMzAzLDYgKzMwMyw4IEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBhZGRf
ZGlza19ub19xdWV1ZV9yZWcoc3RydWN0IGdlbmRpc2sgKmRpc2spDQo+PiAgIGV4dGVybiB2b2lk
IGRlbF9nZW5kaXNrKHN0cnVjdCBnZW5kaXNrICpncCk7DQo+PiAgIGV4dGVybiBzdHJ1Y3QgZ2Vu
ZGlzayAqZ2V0X2dlbmRpc2soZGV2X3QgZGV2LCBpbnQgKnBhcnRubyk7DQo+PiAgIGV4dGVybiBz
dHJ1Y3QgYmxvY2tfZGV2aWNlICpiZGdldF9kaXNrKHN0cnVjdCBnZW5kaXNrICpkaXNrLCBpbnQg
cGFydG5vKTsNCj4+ICtleHRlcm4gc3RydWN0IGJsb2NrX2RldmljZSAqYmRnZXRfZGlza19zZWN0
b3Ioc3RydWN0IGdlbmRpc2sgKmRpc2ssDQo+PiArCQkJc2VjdG9yX3Qgc2VjdG9yKTsNCj4+ICAg
DQo+PiAgIGV4dGVybiB2b2lkIHNldF9kZXZpY2Vfcm8oc3RydWN0IGJsb2NrX2RldmljZSAqYmRl
diwgaW50IGZsYWcpOw0KPj4gICBleHRlcm4gdm9pZCBzZXRfZGlza19ybyhzdHJ1Y3QgZ2VuZGlz
ayAqZGlzaywgaW50IGZsYWcpOw0KPj4gZGlmZiAtLWdpdCBhL2luY2x1ZGUvbGludXgvbWVtcmVt
YXAuaCBiL2luY2x1ZGUvbGludXgvbWVtcmVtYXAuaA0KPj4gaW5kZXggNWY1YjJkZjA2ZTYxLi5l
ZmViZWZhNzBkMDAgMTAwNjQ0DQo+PiAtLS0gYS9pbmNsdWRlL2xpbnV4L21lbXJlbWFwLmgNCj4+
ICsrKyBiL2luY2x1ZGUvbGludXgvbWVtcmVtYXAuaA0KPj4gQEAgLTYsNiArNiw3IEBADQo+PiAg
IA0KPj4gICBzdHJ1Y3QgcmVzb3VyY2U7DQo+PiAgIHN0cnVjdCBkZXZpY2U7DQo+PiArc3RydWN0
IG1mX3JlY292ZXJfY29udHJvbGxlcjsNCj4+ICAgDQo+PiAgIC8qKg0KPj4gICAgKiBzdHJ1Y3Qg
dm1lbV9hbHRtYXAgLSBwcmUtYWxsb2NhdGVkIHN0b3JhZ2UgZm9yIHZtZW1tYXBfcG9wdWxhdGUN
Cj4+IEBAIC04Nyw2ICs4OCw4IEBAIHN0cnVjdCBkZXZfcGFnZW1hcF9vcHMgew0KPj4gICAJICog
dGhlIHBhZ2UgYmFjayB0byBhIENQVSBhY2Nlc3NpYmxlIHBhZ2UuDQo+PiAgIAkgKi8NCj4+ICAg
CXZtX2ZhdWx0X3QgKCptaWdyYXRlX3RvX3JhbSkoc3RydWN0IHZtX2ZhdWx0ICp2bWYpOw0KPj4g
KwlpbnQgKCptZW1vcnlfZmFpbHVyZSkoc3RydWN0IGRldl9wYWdlbWFwICpwZ21hcCwNCj4+ICsJ
CQkgICAgICBzdHJ1Y3QgbWZfcmVjb3Zlcl9jb250cm9sbGVyICptZnJjKTsNCj4+ICAgfTsNCj4+
ICAgDQo+PiAgICNkZWZpbmUgUEdNQVBfQUxUTUFQX1ZBTElECSgxIDw8IDApDQo+PiAtLSANCj4+
IDIuMjguMA0KPj4NCj4+DQo+Pg0KPiANCj4gDQoNCl9fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fCkxpbnV4LW52ZGltbSBtYWlsaW5nIGxpc3QgLS0gbGludXgt
bnZkaW1tQGxpc3RzLjAxLm9yZwpUbyB1bnN1YnNjcmliZSBzZW5kIGFuIGVtYWlsIHRvIGxpbnV4
LW52ZGltbS1sZWF2ZUBsaXN0cy4wMS5vcmcK
