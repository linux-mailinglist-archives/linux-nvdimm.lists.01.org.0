Return-Path: <linux-nvdimm-bounces@lists.01.org>
X-Original-To: lists+linux-nvdimm@lfdr.de
Delivered-To: lists+linux-nvdimm@lfdr.de
Received: from ml01.01.org (ml01.01.org [IPv6:2001:19d0:306:5::1])
	by mail.lfdr.de (Postfix) with ESMTPS id AEACA18C530
	for <lists+linux-nvdimm@lfdr.de>; Fri, 20 Mar 2020 03:13:08 +0100 (CET)
Received: from ml01.vlan13.01.org (localhost [IPv6:::1])
	by ml01.01.org (Postfix) with ESMTP id 831B710FC36E6;
	Thu, 19 Mar 2020 19:13:57 -0700 (PDT)
Received-SPF: Pass (mailfrom) identity=mailfrom; client-ip=63.128.21.74; helo=us-smtp-delivery-74.mimecast.com; envelope-from=xifeng@redhat.com; receiver=<UNKNOWN> 
Received: from us-smtp-delivery-74.mimecast.com (us-smtp-delivery-74.mimecast.com [63.128.21.74])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-SHA384 (256/256 bits))
	(No client certificate requested)
	by ml01.01.org (Postfix) with ESMTPS id 0259310FC36E5
	for <linux-nvdimm@lists.01.org>; Thu, 19 Mar 2020 19:13:54 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=redhat.com;
	s=mimecast20190719; t=1584670383;
	h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
	 to:to:cc:cc:content-type:content-type:
	 content-transfer-encoding:content-transfer-encoding;
	bh=1QuHvI2zPdZVOtYSL2/M1vR3F7L7B4CkV9NLl96ScNo=;
	b=SDcD7v+JMjdXK3P3tjmlMu/3/BlF8+aWnOhUvEgpB1aIMFyP19OA54UHBZL8CxnFqqfcwQ
	4FJ1/lZ5608i5xghJb54wd9DnfGkmgyFakn/uImuy148rQkVLWSHlnksu+OLc1PaT3VKyE
	nrboSamPiD7FvfAYbPvBx37B7WCeZyw=
Received: from mimecast-mx01.redhat.com (mimecast-mx01.redhat.com
 [209.132.183.4]) (Using TLS) by relay.mimecast.com with ESMTP id
 us-mta-274-WLvxKZ-1ODeRDtm7_cfGUA-1; Thu, 19 Mar 2020 22:13:00 -0400
X-MC-Unique: WLvxKZ-1ODeRDtm7_cfGUA-1
Received: from smtp.corp.redhat.com (int-mx02.intmail.prod.int.phx2.redhat.com [10.5.11.12])
	(using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mimecast-mx01.redhat.com (Postfix) with ESMTPS id CA49B477
	for <linux-nvdimm@lists.01.org>; Fri, 20 Mar 2020 02:12:59 +0000 (UTC)
Received: from dhcp-12-126.nay.redhat.com (dhcp-12-126.nay.redhat.com [10.66.12.126])
	by smtp.corp.redhat.com (Postfix) with ESMTP id BE4F660BF7;
	Fri, 20 Mar 2020 02:12:58 +0000 (UTC)
From: XiaoLi Feng <xifeng@redhat.com>
To: linux-nvdimm@lists.01.org
Cc: Xiaoli Feng <xifeng@redhat.com>
Subject: [PATCH v1] test/dax.sh: correct the pmd pagefault counts generated by dax-pmd
Date: Fri, 20 Mar 2020 10:12:55 +0800
Message-Id: <20200320021255.1778-1-xifeng@redhat.com>
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.12
X-Mimecast-Spam-Score: 0
X-Mimecast-Originator: redhat.com
Message-ID-Hash: D46MRECIGP2UNCJKALXU7XAKQIX2LIK2
X-Message-ID-Hash: D46MRECIGP2UNCJKALXU7XAKQIX2LIK2
X-MailFrom: xifeng@redhat.com
X-Mailman-Rule-Misses: dmarc-mitigation; no-senders; approved; emergency; loop; banned-address; member-moderation; nonmember-moderation; administrivia; implicit-dest; max-recipients; max-size; news-moderation; no-subject; suspicious-header
X-Mailman-Version: 3.1.1
Precedence: list
List-Id: "Linux-nvdimm developer list." <linux-nvdimm.lists.01.org>
Archived-At: <https://lists.01.org/hyperkitty/list/linux-nvdimm@lists.01.org/message/D46MRECIGP2UNCJKALXU7XAKQIX2LIK2/>
List-Archive: <https://lists.01.org/hyperkitty/list/linux-nvdimm@lists.01.org/>
List-Help: <mailto:linux-nvdimm-request@lists.01.org?subject=help>
List-Post: <mailto:linux-nvdimm@lists.01.org>
List-Subscribe: <mailto:linux-nvdimm-join@lists.01.org>
List-Unsubscribe: <mailto:linux-nvdimm-leave@lists.01.org>
MIME-Version: 1.0
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit

From: Xiaoli Feng <xifeng@redhat.com>

For directIO, cannot generate pmd pagefault by pread|pwrite|read|write
if do not map fd to memory. In dax-pmd.c, case 1 and case 4 each only
generate once pmd pagefault. So change the all counts from 10 to 8.

Signed-off-by: Xiaoli Feng <xifeng@redhat.com>
---
 test/dax.sh | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/test/dax.sh b/test/dax.sh
index 3933107..bd08641 100755
--- a/test/dax.sh
+++ b/test/dax.sh
@@ -40,13 +40,13 @@ run_test() {
 	# Fragile hack to double check the kernel services this test
 	# with successful pmd faults. If dax-pmd.c ever changes the
 	# number of times the dax_pmd_fault_done trace point fires the
-	# hack needs to be updated from 10 expected firings and the
+	# hack needs to be updated from 8 expected firings and the
 	# result of success (NOPAGE).
 	count=0
 	rc=1
 	while read -r p; do
 		[[ $p ]] || continue
-		if [ "$count" -lt 10 ]; then
+		if [ "$count" -lt 8 ]; then
 			if [ "$p" != "0x100" ] && [ "$p" != "NOPAGE" ]; then
 				cleanup "$1"
 			fi
@@ -54,7 +54,7 @@ run_test() {
 		count=$((count + 1))
 	done < <(trace-cmd report | awk '{ print $21 }')
 
-	if [ $count -lt 10 ]; then
+	if [ $count -lt 8 ]; then
 		cleanup "$1"
 	fi
 }
-- 
2.18.1
_______________________________________________
Linux-nvdimm mailing list -- linux-nvdimm@lists.01.org
To unsubscribe send an email to linux-nvdimm-leave@lists.01.org
